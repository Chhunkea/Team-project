<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Products - SB Bakehouse</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../src/css/productpage.css" />
    <script src="../components/navbar.js"></script>
    <script src="../src/javascript/index.js"></script>
    <!-- Added to reuse renderProducts -->
  </head>
  <body>
    <!-- Navigation Bar -->
    <component-navbar
      brand="SB Bakehouse"
      activeIndex="1"
      links='[{"text": "Home", "href": "../index.html"}, {"text": "Products", "href": "../pages/productpage.html"}, {"text": "Cart", "href": "../pages/cartpage.html"}, {"text": "About Us", "href": "../pages/aboutpage.html"}]'
    >
    </component-navbar>

    <!-- Products Section -->
    <section class="py-5">
      <div class="container">
        <h2 class="text-center mb-4">Our Products</h2>
        <div id="product-container" class="row"></div>
        <!-- Changed to id for dynamic rendering -->
      </div>
    </section>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Load navbar and render products on page load
      window.onload = () => {
        renderProducts("../data/product.json"); // Path relative to pages/
      };

      // Add to Cart functionality with localStorage
      document.addEventListener("click", (e) => {
        if (e.target.classList.contains("add-to-cart")) {
          e.preventDefault();
          const name = e.target.getAttribute("data-name");
          const price = parseFloat(e.target.getAttribute("data-price"));
          const image = e.target.getAttribute("data-image");

          if (!name || isNaN(price) || !image) {
            console.error("Invalid cart item data:", { name, price, image });
            return;
          }

          let cart = JSON.parse(localStorage.getItem("cart")) || [];
          const existingItem = cart.find((item) => item.name === name);

          if (existingItem) {
            existingItem.quantity += 1;
          } else {
            cart.push({ name, price, image, quantity: 1 });
          }

          localStorage.setItem("cart", JSON.stringify(cart));
          alert("Item added to cart!");
        }
      });
    </script>
  </body>
</html>
